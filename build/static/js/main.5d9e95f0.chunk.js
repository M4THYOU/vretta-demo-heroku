(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{102:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(54),o=a.n(r),c=(a(62),a(6)),l=a(7),i=a(8),u=a(9),m=(a(63),a(12)),d=a(17),h=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={},n}return Object(l.a)(a,[{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(d.b,{to:"/app"},"Enter"))}}]),a}(n.Component),g=a(104),p=a(105),f=a(14),v=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={},n}return Object(l.a)(a,[{key:"redirectHandler",value:function(e){var t=this,a=new f.a("wss://inrtpyg747.execute-api.us-east-2.amazonaws.com/dev",{timeout:5e3,maxAttempts:10,onopen:function(e){console.log("Connected!",e),a.json({action:"getToken"})},onmessage:function(a){console.log("Received:",a);var n=JSON.parse(a.data);if("getJWT"===n.eventType){var s=n.Attributes.token;localStorage.setItem("uid",s),localStorage.setItem("isCoach",e),e?t.props.history.push("/app/coach/"):t.props.history.push("/app/player/")}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}})}},{key:"render",value:function(){var e=this,t=localStorage.getItem("isCoach");return"false"===t?this.props.history.push("/app/player"):"true"===t&&this.props.history.push("/app/coach"),localStorage.getItem("uid"),s.a.createElement("div",null,s.a.createElement("h2",null,"App"),s.a.createElement(g.a,null,s.a.createElement(p.a,{outline:!0,color:"primary",onClick:function(){e.redirectHandler(!0)}},"Coach"),s.a.createElement(p.a,{outline:!0,color:"primary",onClick:function(){e.redirectHandler(!1)}},"Player")))}}]),a}(n.Component),y=a(106),E=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;Object(c.a)(this,a),n=t.call(this,e);var s="/app/";return s+=e.isCoach?"coach/":"player/",s+=e.obj._id,n.state={game:e.obj,link:s},n}return Object(l.a)(a,[{key:"render",value:function(){return s.a.createElement(y.a,null,s.a.createElement(d.b,{to:{pathname:this.state.link,state:{game:this.state.game}}},s.a.createElement(p.a,null,this.props.obj._id," | ",this.props.obj.date)))}}]),a}(n.Component);function b(e){var t=Object.keys(e).map((function(t){return{_id:t,date:e[t].date,coachId:e[t].coachId}}));return t.sort((function(e,t){var a=new Date(e.date),n=new Date(t.date);return a>n?-1:a<n?1:0})),t}function k(e,t){return s.a.createElement(E,{obj:e,key:e._id,isCoach:t})}var C=a(107),j=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={games:{},games_sorted:[]},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=new f.a("wss://inrtpyg747.execute-api.us-east-2.amazonaws.com/dev",{timeout:5e3,maxAttempts:10,onopen:function(e){console.log("Connected!",e),t.json({action:"getGames"})},onmessage:function(t){console.log("Received:",t);var a=JSON.parse(t.data);if("gamesData"===a.eventType){console.log(a.Items);var n={};a.Items.forEach((function(e){n[e.gameId]={date:e.date,coachId:e.coachId}}));var s=b(n);e.setState({games:n,games_sorted:s})}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}})}},{key:"render",value:function(){var e=this.state.games_sorted;return s.a.createElement("div",null,s.a.createElement("h2",null,"Player"),s.a.createElement("h3",null,"Games"),s.a.createElement(C.a,null,e.map((function(e){return k(e,!1)}))))}}]),a}(n.Component),I=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={games:{},games_sorted:[]},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.state.socket=new f.a("wss://inrtpyg747.execute-api.us-east-2.amazonaws.com/dev",{timeout:5e3,maxAttempts:10,onopen:function(t){console.log("Connected!",t),e.state.socket.json({action:"getGames"})},onmessage:function(t){console.log("Received:",t);var a=JSON.parse(t.data),n=a.eventType;if("gamesData"===n){console.log(a.Items);var s={};a.Items.forEach((function(e){s[e.gameId]={date:e.date,coachId:e.coachId}}));var r=b(s);e.setState({games:s,games_sorted:r})}else if("createGame"===n){var o=a.gameId;e.props.history.push({pathname:"/app/coach/"+o})}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}})}},{key:"newGame",value:function(){var e={coachId:localStorage.getItem("uid")};this.state.socket.json({action:"createGame",data:e})}},{key:"render",value:function(){var e=this,t=this.state.games_sorted;return s.a.createElement("div",null,s.a.createElement("h2",null,"Coach"),s.a.createElement(p.a,{color:"primary",onClick:function(){e.newGame()}},"Create Game"),s.a.createElement("h3",null,"Games"),s.a.createElement(C.a,null,t.map((function(e){return k(e,!0)}))))}}]),a}(n.Component),O=Object(m.f)(I),w=a(15),S=a(108),A=a(109),M=a(110),x=a(111),B=a(112),N=a(113),T=a(114),U=a(16),R=a.n(U),P=a(37),D=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).audioRef=s.a.createRef(),n.state={chatTitle:"Current Chat",players:[],currentChat:[],broadcasts:[],currentMessage:"",selectedPlayer:null,showBroadcasts:!1,messages:{},game:null,socket:null,isActive:{},hasUnread:{}},n}return Object(l.a)(a,[{key:"exitHandler",value:function(){window.location.href="/app/coach"}},{key:"componentDidMount",value:function(){var e=this;this.state.socket=new f.a("wss://inrtpyg747.execute-api.us-east-2.amazonaws.com/dev",{timeout:5e3,maxAttempts:10,onopen:function(t){console.log("Connected!");var a={gameId:e.props.match.params.gameId};e.state.socket.json({action:"coachConnect",data:a})},onmessage:function(t){console.log("Received:",t);var a=JSON.parse(t.data),n=a.eventType;if("gameData"===n){var s=a.Attributes;console.log(s),e.setState({players:s.players,broadcasts:s.broadcasts,messages:s.messages,game:s,isActive:s.isActive,hasUnread:s.hasUnread})}else if("playerUpdate"===n){var r=a.playerList,o=a.currPlayer,c=a.isActive;console.log(c),console.log(o),e.setState({players:r,isActive:R()(e.state.isActive,Object(w.a)({},o,{$set:c}))})}else if("message"===n){console.log(a);var l=a.Attributes.message,i=a.Attributes.playerId;if(e.audioRef.current.play().catch((function(e){console.log(e)})),i===e.state.selectedPlayer){var u=e.state.currentChat.slice();u.push(l),e.setState({messages:R()(e.state.messages,Object(w.a)({},i,{$set:u})),currentChat:u,hasUnread:R()(e.state.hasUnread,Object(w.a)({},i,{$set:!1}))}),e.updateUnread(i,!1)}else{var m=e.state.messages[i];"undefined"===typeof m&&(m=[]),m.push(l),e.setState({messages:R()(e.state.messages,Object(w.a)({},i,{$set:m})),hasUnread:R()(e.state.hasUnread,Object(w.a)({},i,{$set:!0}))})}}else if("playerChangeConnection"===n){console.log(a);var d=a.Attributes.isActive,h=a.Attributes.playerId;e.setState({isActive:R()(e.state.isActive,Object(w.a)({},h,{$set:d}))})}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}})}},{key:"updateUnread",value:function(e,t){var a={gameId:this.state.game.gameId,unread:t,playerId:e};this.state.socket.json({action:"updateUnread",data:a})}},{key:"playerOnClick",value:function(e){var t=this.state.messages[e];this.state.hasUnread[e]&&this.updateUnread(e,!1),"undefined"===typeof t?this.setState({currentChat:[],selectedPlayer:e,showBroadcasts:!1,chatTitle:"Current Chat",hasUnread:R()(this.state.hasUnread,Object(w.a)({},e,{$set:!1}))}):this.setState({currentChat:t,selectedPlayer:e,showBroadcasts:!1,chatTitle:"Current Chat",hasUnread:R()(this.state.hasUnread,Object(w.a)({},e,{$set:!1}))})}},{key:"sendMessage",value:function(e){var t=this;e.preventDefault();var a=this.state.selectedPlayer,n=this.state.showBroadcasts;if(a||n)if(""!==this.state.currentMessage){var s=localStorage.getItem("uid"),r=this.state.currentMessage,o=this.state.game.gameId,c=this.state.currentChat.slice();if(n){var l={msg:r,isBroadcast:!0,sender:s,date:Date()};c.push(l);var i=this.state.broadcasts.slice();i.push(l),this.setState({broadcasts:i});var u={};if(this.state.players.forEach((function(e){if(t.state.messages[e]){console.log("XX");var a=t.state.messages[e].slice();a.push(l),u[e]=a}else"placeholder"!==e&&(console.log("YY"),u[e]=[l])})),console.log(this.state.messages),console.log(u),this.setState({messages:u}),console.log(this.state.messages),this.state.socket){var m={message:r,gameId:o,coachId:s};this.state.socket.json({action:"broadcast",data:m})}}else{var d={msg:r,isBroadcast:!1,sender:s,date:Date()};if(c.push(d),this.state.socket){var h={coachId:s,message:r,playerId:a,gameId:o};this.state.socket.json({action:"messageFromCoach",data:h})}this.setState({messages:R()(this.state.messages,Object(w.a)({},a,{$set:c})),currentChat:c,currentMessage:""})}this.setState({currentChat:c,currentMessage:""})}else console.log("empty message, returning");else console.log("returning...")}},{key:"broadcastInitHandler",value:function(){this.setState({currentChat:this.state.broadcasts,selectedPlayer:"broadcast",showBroadcasts:!0,chatTitle:"Broadcast"})}},{key:"updateMessage",value:function(e){this.setState({currentMessage:e.target.value})}},{key:"renderMarginCol",value:function(e){if(e)return s.a.createElement(S.a,null)}},{key:"renderBroadcastBar",value:function(e){if(e)return s.a.createElement(y.a,{className:"my-broadcast-bar"})}},{key:"renderMsg",value:function(e,t){var a=e.msg,n=e.isBroadcast,r=e.sender,o=e.date,c=r===localStorage.getItem("uid"),l="secondary";return c&&(l="info"),s.a.createElement(A.a,{key:t},this.renderMarginCol(c),s.a.createElement(S.a,{sm:"auto",className:"no-margin-message"},o,s.a.createElement(y.a,{color:l,key:t},a)),this.renderBroadcastBar(n))}},{key:"renderActiveIndicator",value:function(e){return this.state.isActive[e]?s.a.createElement(p.a,{color:"success",className:"active-button",outline:!0},"Active"):s.a.createElement(p.a,{color:"danger",className:"active-button",outline:!0},"Inactive")}},{key:"renderUnread",value:function(e){if(this.state.hasUnread[e])return s.a.createElement(S.a,null,s.a.createElement("h1",{className:"message-indicator"},"\u2022"))}},{key:"renderPlayer",value:function(e){var t=this,a="player-row";if("placeholder"!==e)return this.state.selectedPlayer===e&&(a+=" selected"),s.a.createElement(A.a,{onClick:function(){return t.playerOnClick(e)},key:e,className:a},s.a.createElement(S.a,{xs:"6",key:e},e.slice(-10)),s.a.createElement(S.a,{xs:"3"},this.renderActiveIndicator(e)),this.renderUnread(e))}},{key:"renderPlayers",value:function(){var e=this,t=[];return null!==this.state&&"undefined"!==typeof this.state&&(t=this.state.players),void 0===t||t.length<2?s.a.createElement("p",null,"Looking for players..."):s.a.createElement(M.a,null,t.map((function(t){return e.renderPlayer(t)})))}},{key:"renderBroadcastButton",value:function(){var e=this;return"broadcast"===this.state.selectedPlayer?s.a.createElement(p.a,{color:"info",onClick:function(){return e.broadcastInitHandler()}},"Broadcast"):s.a.createElement(p.a,{color:"info",onClick:function(){return e.broadcastInitHandler()},outline:!0},"Broadcast")}},{key:"render",value:function(){var e=this,t=this.state.currentChat;"undefined"===typeof t&&(t=[]);var a=this.state.selectedPlayer;return"broadcast"===a?a="":a&&(a=a.slice(-10)),s.a.createElement(M.a,{className:"outer-container"},s.a.createElement("audio",{id:"message-sound",ref:this.audioRef,src:P}),s.a.createElement(p.a,{className:"float-sm-left",color:"danger",onClick:function(){e.exitHandler()}},"EXIT"),s.a.createElement(A.a,{className:"outer-row"},s.a.createElement(S.a,{xs:"6"},s.a.createElement("h2",null,"Broadcast"),this.renderBroadcastButton(),s.a.createElement("h2",null,"Players"),this.renderPlayers()),s.a.createElement(S.a,{xs:"6",className:"chat-view"},s.a.createElement("h2",null,this.state.chatTitle),s.a.createElement("h6",null,a),t.map((function(t,a){return e.renderMsg(t,a)}))),s.a.createElement(S.a,{xs:{size:6,offset:6}},s.a.createElement(x.a,null,s.a.createElement(B.a,{for:"message",hidden:!0},"Type here..."),s.a.createElement(N.a,{type:"text",name:"message",id:"message",placeholder:"Type here...",value:this.state.currentMessage,onChange:function(t){return e.updateMessage(t)}}),s.a.createElement(T.a,{addonType:"append"},s.a.createElement(p.a,{onClick:function(t){return e.sendMessage(t)}},"Send"))))))}}]),a}(n.Component),G=(a(69),a(37)),H=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).audioRef=s.a.createRef();e.location.state.game;return n.state={currentChat:[],currentMessage:"",gameId:null,coachId:null,socket:null},n}return Object(l.a)(a,[{key:"exitHandler",value:function(){window.location.href="/app/player"}},{key:"componentDidMount",value:function(){var e=this,t=localStorage.getItem("uid");this.state.socket=new f.a("wss://inrtpyg747.execute-api.us-east-2.amazonaws.com/dev",{timeout:5e3,maxAttempts:10,onopen:function(a){console.log("Connected!",a);var n=e.props.match.params.gameId,s={uid:t,gameId:n};e.state.socket.json({action:"playerConnect",data:s})},onmessage:function(t){console.log("Received:",t);var a=JSON.parse(t.data),n=a.eventType;if("getGame"===n){var s=a.Attributes.gameId,r=a.Attributes.coachId,o=a.Attributes.chat;e.setState({currentChat:o,gameId:s,coachId:r})}else if("message"===n){var c=a.Attributes.message;e.audioRef.current.play().catch((function(e){console.log(e)}));var l=e.state.currentChat.slice();l.push(c),e.setState({currentChat:l})}else if("broadcast"===n){var i=a.Attributes.message;e.audioRef.current.play().catch((function(e){console.log(e)}));var u=e.state.currentChat.slice();u.push(i),e.setState({currentChat:u})}},onreconnect:function(e){return console.log("Reconnecting...",e)},onmaximum:function(e){return console.log("Stop Attempting!",e)},onclose:function(e){return console.log("Closed!",e)},onerror:function(e){return console.log("Error:",e)}})}},{key:"sendMessage",value:function(e){if(e.preventDefault(),""!==this.state.currentMessage){var t=localStorage.getItem("uid"),a=this.state.currentMessage,n=this.state.gameId,s={msg:a,isBroadcast:!1,sender:t,date:Date()},r=this.state.currentChat.slice();if(r.push(s),this.setState({currentChat:r,currentMessage:""}),console.log(a),this.state.socket){var o={uid:t,message:a,gameId:n};this.state.socket.json({action:"messageFromPlayer",data:o})}}else console.log("empty message, returning")}},{key:"updateMessage",value:function(e){this.setState({currentMessage:e.target.value})}},{key:"renderMarginCol",value:function(e){if(e)return s.a.createElement(S.a,null)}},{key:"renderBroadcastBar",value:function(e){if(e)return s.a.createElement(y.a,{className:"not-my-broadcast-bar"})}},{key:"renderMsg",value:function(e,t){var a=e.msg,n=e.isBroadcast,r=e.sender,o=e.date,c=r===localStorage.getItem("uid"),l="secondary";return c&&(l="info"),s.a.createElement(A.a,{key:t},this.renderMarginCol(c),this.renderBroadcastBar(n),s.a.createElement(S.a,{sm:"auto",className:"no-margin-message"},o,s.a.createElement(y.a,{color:l,key:t},a)))}},{key:"render",value:function(){var e=this,t=this.state.currentChat;return s.a.createElement(M.a,{className:"outer-container"},s.a.createElement("audio",{id:"message-sound",ref:this.audioRef,src:G}),s.a.createElement(p.a,{className:"float-sm-left",color:"danger",onClick:function(){e.exitHandler()}},"EXIT"),s.a.createElement(A.a,{className:"outer-row"},s.a.createElement(S.a,{sm:{size:6,offset:3},className:"chat-view"},s.a.createElement("h2",null,"Current Chat"),t.map((function(t,a){return e.renderMsg(t,a)}))),s.a.createElement(S.a,{sm:{size:6,offset:3}},s.a.createElement(x.a,null,s.a.createElement(B.a,{for:"message",hidden:!0},"Type here..."),s.a.createElement(N.a,{type:"text",name:"message",id:"message",placeholder:"Type here...",value:this.state.currentMessage,onChange:function(t){return e.updateMessage(t)}}),s.a.createElement(T.a,{addonType:"append"},s.a.createElement(p.a,{onClick:function(t){return e.sendMessage(t)}},"Send"))))))}}]),a}(n.Component),$=function(e){Object(u.a)(a,e);var t=Object(i.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement(m.c,null,s.a.createElement(m.a,{exact:!0,path:"/",component:h}),s.a.createElement(m.a,{exact:!0,path:"/app",component:v}),s.a.createElement(m.a,{exact:!0,path:"/app/coach",component:O}),s.a.createElement(m.a,{path:"/app/coach/:gameId",component:D}),s.a.createElement(m.a,{exact:!0,path:"/app/player",component:j}),s.a.createElement(m.a,{path:"/app/player/:gameId",component:H})))}}]),a}(n.Component),_=Object(m.f)($);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(101);o.a.render(s.a.createElement(d.a,null,s.a.createElement(_,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},37:function(e,t,a){e.exports=a.p+"static/media/when.6caba2fa.mp3"},57:function(e,t,a){e.exports=a(102)},62:function(e,t,a){},63:function(e,t,a){},98:function(e,t){}},[[57,1,2]]]);
//# sourceMappingURL=main.5d9e95f0.chunk.js.map